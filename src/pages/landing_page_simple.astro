---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Fix My Furnace Detroit | What's Wrong with Your Furnace?">
  <!-- üî• Hero / Lead Form Section -->
  <section
    class="min-h-screen flex flex-col items-center justify-center bg-gradient-to-br from-red-50 via-white to-gray-50 text-center px-6 pt-16 pb-16"
  >
    <div class="max-w-3xl mx-auto">
      <h1
        class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 leading-tight"
      >
        <span class="text-red-600">No Heat?</span> We'll Fix Your Furnace
        <span class="underline decoration-red-600">Today.</span>
      </h1>

      <p
        class="text-lg md:text-xl text-gray-700 font-semibold mb-10 max-w-2xl mx-auto"
      >
        Fast, licensed, same-day furnace repair from local Metro Detroit HVAC
        pros. Reliable. Honest. Built on Detroit grit.
      </p>
    </div>

    <!-- üßæ Lead Form -->
    <form
      id="leadForm"
      class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md text-left border border-gray-100"
    >
      <!-- Step 1 -->
      <div id="step1" class="space-y-5">
        <div>
          <label
            for="zip"
            class="block font-bold text-gray-800 mb-2 text-sm uppercase tracking-wide"
            >Enter Your ZIP Code</label
          >
          <input
            type="text"
            id="zip"
            maxlength="5"
            placeholder="e.g. 48226"
            class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base"
          />
        </div>

        <button
          type="button"
          id="nextStep"
          class="w-full bg-red-600 text-white font-bold py-3 rounded-lg shadow hover:bg-red-700 active:scale-[0.98] transition"
        >
          Check Availability
        </button>
      </div>

      <!-- Step 2 -->
      <div id="step2" class="hidden space-y-8">
        <!-- Section 1: Issue Selection -->
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
          <label
            class="block font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide"
            >What's happening with your furnace?</label
          >
          <select
            id="issue"
            class="w-full border border-gray-300 rounded-lg p-3 text-base focus:ring-2 focus:ring-red-500 focus:border-red-500"
          >
            <option value="">Select an issue...</option>
            <option>It won't turn on</option>
            <option>It's blowing cold air</option>
            <option>Strange noises</option>
            <option>Old or unreliable</option>
            <option>Not sure</option>
          </select>
        </div>

        <!-- Section 2: Photo Upload -->
        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
          <label class="block font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide">
            Upload Photos (Optional but Helpful)
          </label>
          
          <!-- Upload Instructions -->
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 text-sm">
            <p class="font-medium text-blue-800 mb-2">üì∏ Photo Tips for Faster Service:</p>
            <ul class="text-blue-700 space-y-1 text-xs">
              <li>‚Ä¢ Take photos from multiple angles</li>
              <li>‚Ä¢ Use good lighting (turn on flashlight if needed)</li>
              <li>‚Ä¢ Include close-ups of labels, stickers, or model numbers</li>
              <li>‚Ä¢ Show the overall unit and any problem areas</li>
            </ul>
          </div>

          <!-- File Upload Area -->
          <div 
            id="uploadArea"
            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-500 transition-colors cursor-pointer bg-white"
          >
            <div class="text-gray-500">
              <svg class="mx-auto h-12 w-12 text-gray-400 mb-2" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <p class="text-sm font-medium">Click to upload photos or drag and drop</p>
              <p class="text-xs text-gray-400 mt-1">PNG, JPG up to 10MB each</p>
            </div>
            <input 
              type="file" 
              id="photoInput"
              multiple 
              accept="image/*"
              class="hidden"
            />
          </div>

          <!-- Photo Preview Area -->
          <div id="photoPreview" class="mt-3 grid grid-cols-2 gap-2 hidden"></div>
        </div>

        <button
          type="submit"
          class="w-full bg-red-600 text-white font-bold py-3 rounded-lg shadow hover:bg-red-700 active:scale-[0.98] transition"
        >
          Get My Furnace Fixed
        </button>
      </div>
    </form>

    <!-- ‚úÖ Trust Bar -->
    <div
      class="flex flex-wrap justify-center gap-6 mt-10 text-sm md:text-base font-semibold text-gray-700"
    >
      <div class="flex items-center gap-2">
        <i class="text-red-600">üè†</i> Detroit Local
      </div>
      <div class="flex items-center gap-2">
        <i class="text-red-600">üïí</i> Same-Day Service
      </div>
      <div class="flex items-center gap-2">
        <i class="text-red-600">‚úÖ</i> Licensed & Insured
      </div>
    </div>

    <!-- üß≠ Background Accent -->
    <div
      class="absolute inset-0 bg-gradient-to-b from-red-50/20 via-transparent to-gray-50 pointer-events-none -z-10"
    ></div>
  </section>

  <!-- ‚öôÔ∏è Footer -->
  <footer class="bg-gray-900 text-gray-300 text-center text-sm py-6 mt-10">
    <p>¬© 2025 Fix My Furnace Detroit. All rights reserved.</p>
  </footer>
</Layout>

<!-- üß† Script -->
<script>
  const zipInput = document.getElementById("zip");
  const step1 = document.getElementById("step1");
  const step2 = document.getElementById("step2");
  const nextStep = document.getElementById("nextStep");
  const form = document.getElementById("leadForm");
  const uploadArea = document.getElementById("uploadArea");
  const photoInput = document.getElementById("photoInput");
  const photoPreview = document.getElementById("photoPreview");
  
  let uploadedFiles = [];

  nextStep.addEventListener("click", () => {
    const zip = zipInput.value.trim();
    if (!zip || zip.length !== 5) {
      alert("Please enter a valid ZIP code.");
      return;
    }
    step1.classList.add("hidden");
    step2.classList.remove("hidden");
  });

  // Photo upload functionality
  uploadArea.addEventListener("click", () => {
    photoInput.click();
  });

  uploadArea.addEventListener("dragover", (e) => {
    e.preventDefault();
    uploadArea.classList.add("border-red-500", "bg-red-50");
  });

  uploadArea.addEventListener("dragleave", (e) => {
    e.preventDefault();
    uploadArea.classList.remove("border-red-500", "bg-red-50");
  });

  uploadArea.addEventListener("drop", (e) => {
    e.preventDefault();
    uploadArea.classList.remove("border-red-500", "bg-red-50");
    const files = e.dataTransfer.files;
    handleFiles(files);
  });

  photoInput.addEventListener("change", (e) => {
    handleFiles(e.target.files);
  });

  function handleFiles(files) {
    Array.from(files).forEach(file => {
      if (file.type.startsWith("image/") && file.size <= 10 * 1024 * 1024) {
        uploadedFiles.push(file);
        createPreview(file);
      } else {
        alert("Please upload images under 10MB only.");
      }
    });
  }

  function createPreview(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      const preview = document.createElement("div");
      preview.className = "relative group";
      preview.innerHTML = `
        <img src="${e.target.result}" class="w-full h-20 object-cover rounded-lg border">
        <button type="button" onclick="removePhoto(this)" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center hover:bg-red-600">√ó</button>
      `;
      photoPreview.appendChild(preview);
      photoPreview.classList.remove("hidden");
    };
    reader.readAsDataURL(file);
  }

  function removePhoto(button) {
    const preview = button.parentElement;
    const index = Array.from(photoPreview.children).indexOf(preview);
    uploadedFiles.splice(index, 1);
    preview.remove();
    if (uploadedFiles.length === 0) {
      photoPreview.classList.add("hidden");
    }
  }

  // Make removePhoto globally accessible
  window.removePhoto = removePhoto;

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const issueSelected = document.getElementById("issue").value;
    if (!issueSelected) {
      alert("Please select what's happening with your furnace.");
      return;
    }
    
    let message = "Thanks! A local tech will reach out shortly.";
    if (uploadedFiles.length > 0) {
      message += ` We received ${uploadedFiles.length} photo(s) to help diagnose your issue.`;
    }
    
    alert(message);
    form.reset();
    uploadedFiles = [];
    photoPreview.innerHTML = "";
    photoPreview.classList.add("hidden");
    step2.classList.add("hidden");
    step1.classList.remove("hidden");
  });
</script>