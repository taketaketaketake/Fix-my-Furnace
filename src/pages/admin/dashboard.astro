---
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../lib/supabase.js";

// Simple admin protection - check for admin password in URL params
const url = new URL(Astro.request.url);
const adminKey = url.searchParams.get('key');
const ADMIN_KEY = 'hvac2024admin'; // In production, use environment variable

if (adminKey !== ADMIN_KEY) {
  return new Response('Unauthorized', { status: 401 });
}

const leads = [
  // placeholder data - replace with real data later
  {
    id: "LD-1024",
    name: "Sarah Jenkins",
    phone: "(248) 555-0198",
    source: "Google Ads",
    type: "Photo Upload",
    status: "New",
    created_at: "2025-12-10 09:32 AM",
  },
  {
    id: "LD-1025",
    name: "Marcus Bell",
    phone: "(313) 555-4421",
    source: "Facebook Leads",
    type: "Emergency Heat Issue",
    status: "Contacted",
    created_at: "2025-12-10 10:15 AM",
  },
  {
    id: "LD-1026",
    name: "Unknown",
    phone: "(586) 555-2020",
    source: "Website Form",
    type: "Furnace Not Heating",
    status: "Scheduled",
    created_at: "2025-12-10 11:02 AM",
  },
];
---

<Layout title="Fix My Furnace – Lead Dashboard" hideHeader={true} hideTopBanner={true}>

    <!-- Dashboard Header -->
    <header class="bg-red-600 text-white px-8 py-6 shadow-md flex items-center justify-between">
      <h1 class="text-3xl font-bold tracking-wide">Fix My Furnace — Leads Dashboard</h1>
      <button class="bg-white text-red-600 font-semibold px-4 py-2 rounded hover:bg-gray-200 transition">
        Export CSV
      </button>
    </header>

    <!-- Filters -->
    <div class="px-8 py-4 flex gap-4 bg-white shadow-sm border-b">
      <select class="px-4 py-2 border rounded">
        <option>All Lead Sources</option>
        <option>Google Ads</option>
        <option>Facebook</option>
        <option>Website Form</option>
      </select>

      <select class="px-4 py-2 border rounded">
        <option>All Statuses</option>
        <option>New</option>
        <option>Contacted</option>
        <option>Scheduled</option>
        <option>Completed</option>
      </select>

      <select class="px-4 py-2 border rounded">
        <option>All Types</option>
        <option>Photo Upload</option>
        <option>Emergency Issue</option>
        <option>General Inquiry</option>
      </select>
    </div>

    <!-- Lead Table -->
    <main class="p-8">
      <div class="overflow-x-auto bg-white shadow-lg rounded-lg">
        <table class="min-w-full text-left">
          <thead class="bg-gray-800 text-white uppercase text-sm">
            <tr>
              <th class="px-6 py-3">Lead ID</th>
              <th class="px-6 py-3">Customer</th>
              <th class="px-6 py-3">Phone</th>
              <th class="px-6 py-3">Source</th>
              <th class="px-6 py-3">Type</th>
              <th class="px-6 py-3">Status</th>
              <th class="px-6 py-3">Created</th>
              <th class="px-6 py-3">Actions</th>
            </tr>
          </thead>

          <tbody>
            {leads.map((lead) => (
              <tr class="border-b hover:bg-gray-50 text-sm">
                <td class="px-6 py-4 font-semibold">{lead.id}</td>
                <td class="px-6 py-4">{lead.name}</td>
                <td class="px-6 py-4">{lead.phone}</td>
                <td class="px-6 py-4">{lead.source}</td>
                <td class="px-6 py-4">{lead.type}</td>
                <td class="px-6 py-4">
                  <span
                    class={`px-2 py-1 rounded text-white ${
                      lead.status === "New"
                        ? "bg-red-500"
                        : lead.status === "Contacted"
                        ? "bg-blue-500"
                        : lead.status === "Scheduled"
                        ? "bg-green-600"
                        : "bg-gray-600"
                    }`}
                  >
                    {lead.status}
                  </span>
                </td>
                <td class="px-6 py-4">{lead.created_at}</td>
                <td class="px-6 py-4">
                  <a href={`/admin/dashboard/lead/${lead.id}?key=${adminKey}`} class="text-red-600 font-semibold hover:underline">
                    View Details →
                  </a>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </main>

</Layout>