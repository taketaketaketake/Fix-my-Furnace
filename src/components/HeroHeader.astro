---
/**
 * HeroHeader.astro
 * Split hero layout â€“ full-width image left, text right.
 * Includes a modal form that opens from the primary button.
 */
import UniversalForm from "./UniversalForm.astro";

const phoneNumber = import.meta.env.TELNYX_PHONE_NUMBER || '+18334948669';

 const {
  title = "Built on Trust, Speed, and Real Detroit Grit.",
  description = "We're not a call center â€” we're your local HVAC pros. When the cold hits and your furnace fails, we show up fast â€” licensed, local, and ready to get the heat back on.",
  primaryBtnText = "Get a Free Quote",
  secondaryBtnText = "Call Now",
  secondaryBtnLink = `tel:${phoneNumber}`,
  imageSrc = "/Licensed HVAC Technician Ready to Help.png"
} = Astro.props;

// Form fields for the hero modal form
const heroModalFields = [
  {
    name: 'name',
    type: 'text',
    label: 'Name',
    placeholder: 'John Doe',
    required: true,
    autoComplete: 'name'
  },
  {
    name: 'phone',
    type: 'tel',
    label: 'Phone Number',
    placeholder: '(313) 555-1234',
    required: true,
    autoComplete: 'tel'
  },
  {
    name: 'message',
    type: 'textarea',
    label: 'Message',
    placeholder: 'Briefly describe your issue...',
    required: true,
    rows: 3
  }
];
---

<section class="relative w-full bg-white overflow-hidden">
  <div class="flex flex-col-reverse md:grid md:grid-cols-2 min-h-[600px] lg:min-h-[700px]">
    <!-- ðŸ§± Left: Text -->
    <div class="flex items-center justify-center px-6 md:px-12 py-16 md:py-0 bg-gradient-to-br from-red-50 via-gray-50 to-white">
      <div class="max-w-lg text-left">
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-6 leading-tight tracking-tight">
          <span class="text-red-600">Furnace Repair</span> &<br />
          <span class="underline decoration-red-600">HVAC Services Across Michigan.</span>
        </h1>

        <p class="text-gray-700 text-base md:text-lg font-semibold leading-relaxed mb-8">
          Emergency furnace repair when you need it most. Our licensed Michigan technicians respond fast to get your heat restored today â€” serving Detroit, Grand Rapids, Ann Arbor, and every corner of the state.
        </p>

        <div class="flex flex-wrap gap-4">
          <!-- Primary button triggers modal -->
          <button
            id="openModalBtn"
            class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-red-700 active:scale-[0.98] transition"
          >
            {primaryBtnText}
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸ”§ Right: Image -->
    <div class="relative w-full flex items-center justify-center bg-white py-6 md:py-0">
      <img
        src={imageSrc}
        alt="Professional Michigan HVAC technician providing furnace repair and installation services across Detroit, Grand Rapids, Ann Arbor, and all Michigan cities"
        class="w-full max-w-[700px] h-auto object-contain"
        loading="eager"
      />
    </div>

  <!-- Decorative red bar -->
  <div class="absolute bottom-0 left-0 w-full h-2 bg-red-600"></div>

<!-- ðŸ’¬ Modal -->
<div
  id="quoteModal"
  class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4"
>
  <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-auto p-8 relative">
    <!-- Close button -->
    <button
      id="closeModalBtn"
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 transition"
    >
      âœ•
    </button>

    <UniversalForm
      formId="hero-modal-form"
      formSource="hero_modal"
      apiEndpoint="/api/submit-form"
      title="Stop Freezing - Fix Your Furnace"
      description="Fill out the form and a local HVAC expert will contact you shortly."
      fields={heroModalFields}
      submitText="Submit Request"
      className=""
    />
  </div>
</div>

  <!-- ðŸ§  Modal Script -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const modal = document.getElementById("quoteModal");
      const openBtn = document.getElementById("openModalBtn");
      const closeBtn = document.getElementById("closeModalBtn");
      const modalForm = document.querySelector('#quoteModal form');
  
      // Modal open/close functionality
      openBtn?.addEventListener("click", () => {
        modal.classList.remove("hidden");
        modal.classList.add("flex"); // ensure centering
      });
  
      const closeModal = () => {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        // Reset form when closing
        modalForm?.reset();
        // Hide any form messages
        const formMessages = modal.querySelector('#hero-modal-form-messages');
        if (formMessages) {
          formMessages.classList.add('hidden');
        }
      };
  
      closeBtn?.addEventListener("click", closeModal);
      modal?.addEventListener("click", (e) => {
        if (e.target === modal) closeModal();
      });

      // Listen for form success to auto-close modal
      modal?.addEventListener('formSubmissionSuccess', () => {
        setTimeout(() => closeModal(), 3000);
      });
    });
  </script>
  
</section>
