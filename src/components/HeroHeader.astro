---
/**
 * HeroHeader.astro
 * Split hero layout â€“ full-width image left, text right.
 * Includes a modal form that opens from the primary button.
 */
 const {
  title = "Built on Trust, Speed, and Real Detroit Grit.",
  description = "Weâ€™re not a call center â€” weâ€™re your local HVAC pros. When the cold hits and your furnace fails, we show up fast â€” licensed, local, and ready to get the heat back on.",
  primaryBtnText = "Get a Free Quote",
  secondaryBtnText = "Call Now",
  secondaryBtnLink = "tel:+8334948669",
  imageSrc = "/fixmyfurnacewoman.png"
} = Astro.props;
---

<section class="relative w-full bg-white overflow-hidden">
  <div class="flex flex-col-reverse md:grid md:grid-cols-2 min-h-[600px] lg:min-h-[700px]">
    <!-- ðŸ§± Left: Text -->
    <div class="flex items-center justify-center px-6 md:px-12 py-16 md:py-0 bg-gradient-to-br from-red-50 via-gray-50 to-white">
      <div class="max-w-lg text-left">
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-6 leading-tight tracking-tight">
          <span class="text-red-600">Furnace Repair</span> &<br />
          <span class="underline decoration-red-600">HVAC Services Across Michigan.</span>
        </h1>

        <p class="text-gray-700 text-base md:text-lg font-semibold leading-relaxed mb-8">
          Emergency furnace repair when you need it most. Our licensed Michigan technicians respond fast to get your heat restored today â€” serving Detroit, Grand Rapids, Ann Arbor, and every corner of the state.
        </p>

        <div class="flex flex-wrap gap-4">
          <!-- Primary button triggers modal -->
          <button
            id="openModalBtn"
            class="bg-red-600 text-white px-6 py-3 rounded-lg font-bold shadow hover:bg-red-700 active:scale-[0.98] transition"
          >
            {primaryBtnText}
          </button>
        </div>
      </div>
    </div>

    <!-- ðŸ”§ Right: Image -->
    <div class="relative w-full flex items-center justify-center bg-white py-6 md:py-0">
      <img
        src="fixmyfurnacewoman.png"
        alt="Professional Michigan HVAC technician providing furnace repair and installation services across Detroit, Grand Rapids, Ann Arbor, and all Michigan cities"
        class="w-full max-w-[700px] h-auto object-contain"
        loading="eager"
      />
    </div>

  <!-- Decorative red bar -->
  <div class="absolute bottom-0 left-0 w-full h-2 bg-red-600"></div>

<!-- ðŸ’¬ Modal -->
<div
  id="quoteModal"
  class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-[100] flex items-center justify-center p-4"
>
  <div class="bg-white rounded-2xl shadow-xl max-w-md w-full mx-auto p-8 relative">
    <!-- Close button -->
    <button
      id="closeModalBtn"
      class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 transition"
    >
      âœ•
    </button>

    <h2 class="text-2xl font-extrabold text-gray-900 mb-4 text-center">
      Stop Freezing - Fix Your Furnace
    </h2>
    <p class="text-gray-600 text-sm text-center mb-6">
      Fill out the form and a local HVAC expert will contact you shortly.
    </p>

    <!-- Success/Error Message Container -->
    <div id="modalFormMessages" class="mb-6 hidden">
      <div id="modalSuccessMessage" class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4 hidden">
        <div class="flex items-center">
          <svg class="w-4 h-4 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <p class="text-green-800 font-semibold text-sm">Request sent! We'll contact you shortly.</p>
        </div>
      </div>
      
      <div id="modalErrorMessage" class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4 hidden">
        <div class="flex items-center">
          <svg class="w-4 h-4 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <p class="text-red-800 font-semibold text-sm">Something went wrong. Please try again.</p>
        </div>
      </div>

      <div id="modalLoadingMessage" class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4 hidden">
        <div class="flex items-center">
          <svg class="animate-spin w-4 h-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <p class="text-blue-800 font-semibold text-sm">Sending your request...</p>
        </div>
      </div>
    </div>

    <form class="space-y-4" id="appointmentForm">
      <!-- Hidden honeypot field for spam protection -->
      <div style="display: none;">
        <label>Don't fill this out if you're human: <input name="bot-field" /></label>
      </div>
      
      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">Name</label>
        <input
          type="text"
          name="name"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
          placeholder="John Doe"
          required
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">Phone Number</label>
        <input
          type="tel"
          name="phone"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
          placeholder="(313) 555-1234"
          required
        />
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 mb-1">Message</label>
        <textarea
          rows="3"
          name="message"
          class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-600"
          placeholder="Briefly describe your issue..."
          required
        ></textarea>
      </div>

      <button
        type="submit"
        id="modalSubmitBtn"
        class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <span id="modalSubmitText">Submit Request</span>
        <span id="modalSubmitLoading" class="hidden">
          <svg class="animate-spin inline w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Sending...
        </span>
      </button>
    </form>
  </div>
</div>

  <!-- ðŸ§  Modal Script -->
  <script type="module">
    // Import Supabase from CDN for client-side use
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';
    
    document.addEventListener("DOMContentLoaded", () => {
      // Supabase configuration
      const supabaseUrl = 'https://ztvsfapoeekaxztahxsv.supabase.co';
      const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp0dnNmYXBvZWVrYXh6dGFoeHN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMDUzMDIsImV4cCI6MjA3NzY4MTMwMn0.4ff8bfxwEUlJN3JQ3QGsys-xB9Xqu8zUspJSvtzL06k';
      const supabase = createClient(supabaseUrl, supabaseAnonKey);
      const modal = document.getElementById("quoteModal");
      const openBtn = document.getElementById("openModalBtn");
      const closeBtn = document.getElementById("closeModalBtn");
      
      // Modal form handling
      const modalForm = document.getElementById('appointmentForm');
      const modalSubmitBtn = document.getElementById('modalSubmitBtn');
      const modalSubmitText = document.getElementById('modalSubmitText');
      const modalSubmitLoading = document.getElementById('modalSubmitLoading');
      const modalFormMessages = document.getElementById('modalFormMessages');
      const modalSuccessMessage = document.getElementById('modalSuccessMessage');
      const modalErrorMessage = document.getElementById('modalErrorMessage');
      const modalLoadingMessage = document.getElementById('modalLoadingMessage');
  
      // Modal open/close functionality
      openBtn?.addEventListener("click", () => {
        modal.classList.remove("hidden");
        modal.classList.add("flex"); // ensure centering
      });
  
      const closeModal = () => {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        // Reset form and hide messages when closing
        hideModalMessages();
        modalForm?.reset();
      };
  
      closeBtn?.addEventListener("click", closeModal);
      modal?.addEventListener("click", (e) => {
        if (e.target === modal) closeModal();
      });

      // Form submission handling (if modal form exists)
      if (modalForm) {
        // Function to show specific message
        function showModalMessage(messageType) {
          // Hide all messages first
          modalSuccessMessage.classList.add('hidden');
          modalErrorMessage.classList.add('hidden');
          modalLoadingMessage.classList.add('hidden');
          
          // Show container and specific message
          modalFormMessages.classList.remove('hidden');
          document.getElementById('modal' + messageType.charAt(0).toUpperCase() + messageType.slice(1) + 'Message').classList.remove('hidden');
        }

        // Function to hide all messages
        function hideModalMessages() {
          modalFormMessages.classList.add('hidden');
          modalSuccessMessage.classList.add('hidden');
          modalErrorMessage.classList.add('hidden');
          modalLoadingMessage.classList.add('hidden');
        }

        // Function to set loading state
        function setModalLoadingState(loading) {
          modalSubmitBtn.disabled = loading;
          if (loading) {
            modalSubmitText.classList.add('hidden');
            modalSubmitLoading.classList.remove('hidden');
            showModalMessage('loading');
          } else {
            modalSubmitText.classList.remove('hidden');
            modalSubmitLoading.classList.add('hidden');
          }
        }

        // Handle form submission
        modalForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          setModalLoadingState(true);
          
          try {
            // Get form data
            const formData = new FormData(modalForm);
            const name = formData.get('name')?.trim();
            const phone = formData.get('phone')?.trim();
            const message = formData.get('message')?.trim();
            
            // Basic validation
            if (!name || !phone || !message) {
              throw new Error('Please fill in all required fields');
            }
            
            // Save to Supabase database
            const { data, error } = await supabase
              .from('form_submissions')
              .insert([
                {
                  full_name: name,
                  phone_number: phone,
                  service_address: '',
                  furnace_issue: message,
                  photo_count: 0,
                  photo_urls: [],
                  form_source: 'hero_modal'
                }
              ]);
            
            if (error) {
              console.error('Error saving form:', error);
              throw new Error('Failed to submit form');
            }
            
            // Success
            setModalLoadingState(false);
            showModalMessage('success');
            modalForm.reset(); // Clear form
            
            // Close modal after 3 seconds
            setTimeout(() => closeModal(), 3000);
            
          } catch (error) {
            console.error('Submission error:', error);
            setModalLoadingState(false);
            showModalMessage('error');
            
            // Hide error message after 5 seconds
            setTimeout(() => hideModalMessages(), 5000);
          }
        });
      }
    });
  </script>
  
</section>
