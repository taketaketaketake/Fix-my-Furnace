---
/**
 * ServiceAreasSection.astro
 * Displays interactive Mapbox map and featured cities.
 * Requires a Mapbox access token in your .env file.
 */

 const MAPBOX_TOKEN = import.meta.env.PUBLIC_MAPBOX_TOKEN;
---

<section class="relative bg-gradient-to-br from-red-50 via-white to-orange-50 py-20 px-6 md:px-10">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">
        We <span class="text-red-600">Service All of Michigan</span>
      </h2>
      <p class="text-lg md:text-xl font-semibold text-gray-700 max-w-3xl mx-auto">
        From Detroit to Grand Rapids, Ann Arbor to Flint — if there’s a furnace in Michigan, we’ll fix it.
      </p>
    </div>

    <!-- Layout -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 md:gap-16 items-center">
      <!-- 🗺️ Map -->
      <div class="w-full h-[400px] rounded-2xl overflow-hidden shadow-xl border border-gray-200">
        <div id="map" class="w-full h-full"></div>
      </div>

      <!-- 📍 City List -->
      <div class="flex flex-col justify-center">
        <h3 class="text-2xl font-bold text-gray-900 mb-6 border-l-4 border-red-600 pl-3">
          Featured Service Areas
        </h3>

        <ul class="grid grid-cols-1 sm:grid-cols-2 gap-y-4 text-lg font-semibold text-gray-800">
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Detroit Metro
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Ann Arbor
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Flint
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Grand Rapids
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Lansing
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Kalamazoo
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Traverse City
          </li>
          <li class="flex items-center gap-3">
            <i data-lucide="map-pin" class="w-5 h-5 text-red-600"></i> Saginaw
          </li>
        </ul>

        <p class="text-gray-600 mt-8 text-base md:text-lg">
          Can’t find your city listed? Don’t worry — we cover every corner of Michigan. 
          <span class="font-bold text-red-600">Call today</span> to get your local tech scheduled.
        </p>
      </div>
    </div>
  </div>

  <!-- Mapbox JS -->
  <script
    type="module"
    src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"
  ></script>

  <script
    src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"
    defer
  ></script>
  <link
    href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css"
    rel="stylesheet"
  />

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();

      mapboxgl.accessToken = "{MAPBOX_TOKEN}";
      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/streets-v12",
        center: [-84.5, 44.3], // Center of Michigan
        zoom: 5.3,
      });

      // Add navigation controls
      map.addControl(new mapboxgl.NavigationControl(), "top-right");

      // Add a border outline for Michigan (GeoJSON fetch)
      map.on("load", async () => {
        const response = await fetch(
          "https://raw.githubusercontent.com/deldersveld/topojson/master/countries/us-states/MI-26-michigan-counties.json"
        );
        const data = await response.json();

        map.addSource("michigan", {
          type: "geojson",
          data,
        });

        map.addLayer({
          id: "michigan-border",
          type: "line",
          source: "michigan",
          paint: {
            "line-color": "#ef4444",
            "line-width": 2,
          },
        });

        // Add subtle fill
        map.addLayer({
          id: "michigan-fill",
          type: "fill",
          source: "michigan",
          paint: {
            "fill-color": "#ef4444",
            "fill-opacity": 0.05,
          },
        });
      });
    });
  </script>
</section>
